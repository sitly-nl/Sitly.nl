<ng-template #continueButton>
    <system-button class="btn-continue" (click)="continueClicked()" [loading]="loading">
        {{ 'main.continue' | translate }}
    </system-button>
</ng-template>

<div class="auth-page-container">
    <toolbar [leftItems]="[ToolbarItem.back]" (itemSelected)="navigationService.back()"></toolbar>

    <div class="form-container" [class.additional-bottom-padding]="!isDesktop()">
        <div class="text-container">
            <div class="title">{{ 'signUp.title' | translate }}</div>
            <div class="message">{{ 'signUp.subtitle' | translate }}</div>
        </div>

        <social-sso class="social-btn-container" (token)="onAuthTokenReceived($event)" (loading)="onSocialSsoLoading($event)"></social-sso>
        <div class="or-label">{{ 'signIn.or' | translate }}</div>

        <form>
            <fieldset>
                <legend>{{ 'signUp.accountInfo.title' | translate }}</legend>

                <div class="form-field-group">
                    <mat-form-field class="email-field" [class.ng-invalid]="hasEmailError">
                        <mat-label>
                            {{ 'main.email.placeholder' | translate }}
                        </mat-label>
                        <input matInput type="email" class="form-control" [formControl]="emailControl" name="email" />
                        @if (!hasEmailError) {
                            <img class="action-right" src="assets/images/checkmark-green.svg" />
                        }
                    </mat-form-field>
                    @if (hasEmailError && errors.email !== 'emailAlreadyUsed') {
                        <div class="error">
                            {{ 'signUp.email.error' | translate }}
                        </div>
                    }
                    @if (errors.email === 'emailAlreadyUsed') {
                        <div class="error">
                            {{ 'signUp.error.emailAlreadyUsed' | translate }}
                        </div>
                    }
                </div>

                <div class="form-field-group">
                    <mat-form-field [class.ng-invalid]="hasPasswordError">
                        <mat-label>
                            {{ 'signUp.password.placeholder' | translate }}
                        </mat-label>
                        <input
                            #passwordInput
                            type="password"
                            matInput
                            class="form-control"
                            [formControl]="passwordControl"
                            name="password"
                        />
                        <button
                            class="mat-form-field-suffix"
                            type="button"
                            matSuffix
                            aria-label="Show"
                            (click)="$event.stopPropagation(); passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password'"
                        >
                            {{ (passwordInput.type === 'password' ? 'main.password.show' : 'main.password.hide') | translate }}
                        </button>
                    </mat-form-field>
                    @if (hasPasswordError) {
                        <div class="error">
                            {{ 'signUp.password.error' | translate }}
                        </div>
                    }
                </div>
            </fieldset>

            <fieldset>
                <legend>{{ 'signUp.personalInfo.title' | translate }}</legend>

                <div class="form-field-group names-group">
                    <div class="form-field-group">
                        <mat-form-field [class.ng-invalid]="hasFirstNameError">
                            <mat-label>
                                {{ 'main.firstName.placeholder' | translate }}
                            </mat-label>
                            <input matInput class="form-control" [formControl]="firstNameControl" />
                            @if (!hasFirstNameError && firstNameControl.touched) {
                                <img class="action-right" src="assets/images/checkmark-green.svg" />
                            }
                        </mat-form-field>
                        @if (hasFirstNameError) {
                            <div class="error">
                                {{ 'signUp.firstName.error' | translate }}
                            </div>
                        }
                    </div>

                    <div class="form-field-group">
                        <mat-form-field [class.ng-invalid]="hasLastNameError">
                            <mat-label>
                                {{ 'main.lastName.placeholder' | translate }}
                            </mat-label>
                            <input matInput class="form-control" [formControl]="lastNameControl" />
                            @if (!hasLastNameError && lastNameControl.touched) {
                                <img class="action-right" src="assets/images/checkmark-green.svg" />
                            }
                        </mat-form-field>
                        @if (hasLastNameError) {
                            <div class="error">
                                {{ 'signUp.lastName.error' | translate }}
                            </div>
                        }
                    </div>
                </div>

                <div class="form-field-group">
                    <mat-form-field [class.ng-invalid]="hasCountryError">
                        <mat-label>
                            {{ 'main.country.placeholder' | translate }}
                        </mat-label>
                        <mat-select [formControl]="countryControl">
                            @for (country of countries; track country.id) {
                                <mat-option value="{{ country.countryCode }}">{{ country.name }}</mat-option>
                            }
                        </mat-select>
                    </mat-form-field>
                    @if (hasCountryError) {
                        <div class="error">
                            {{ 'signUp.country.error' | translate }}
                        </div>
                    }
                </div>
            </fieldset>

            @if (genericError) {
                <div class="error">
                    {{ 'signUp.error' | translate }}
                </div>
            }

            <terms-and-privacy></terms-and-privacy>

            @if (isDesktop()) {
                <ng-container *ngTemplateOutlet="continueButton"></ng-container>
            }
        </form>

        @if (!isDesktop()) {
            <div class="bottom-container shown">
                <ng-container *ngTemplateOutlet="continueButton"></ng-container>
            </div>
        }
    </div>
</div>
